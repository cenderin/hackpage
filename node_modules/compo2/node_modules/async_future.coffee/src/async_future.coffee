class AsyncFuture

  constructor: (method, params...) ->
    params.push @data_received
    method.apply {}, params


  # Called when the database result comes in.
  data_received: (result) =>
    if @get_callback
      # Getter was already called --> call it's callback now with the result.
      @get_callback result
    else
      # Getter hasn't been called yet --> save the result for later.
      @result = result


  get: (callback) ->
    if @result
      # We have the result already --> call the callback method directly.
      callback @result
    else
      # We are still waiting for the result to come in --> store the callback for later.
      @get_callback = callback



module.exports = AsyncFuture
