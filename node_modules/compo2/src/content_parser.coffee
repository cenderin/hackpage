QueryString = require 'querystring'
util = require 'util'

# Parses the content of requests into a hash structure.
#
# Can handle different content types.
# Implemented in a VM friendly way by using static data and lookups.
class ContentParser

  # Parses the given text with the given encoding.
  @parse: (text, encoding) ->
    return {} unless text
    parser = ContentParser.parsers[encoding]
    unless parser
      util.log "Error (ContentParser.parse): Cannot find a parser for the content type '#{encoding}'."
      return ''
    parser text


  # Parses JSON-encoded form data into a hash.
  @parse_json: (text) ->
    JSON.parse text


  # Parses form data encoded with 'application/x-www-form-urlencoded' into a hash.
  @parse_www_form: (text) ->
    QueryString.parse text


  @parsers =
    'application/x-www-form-urlencoded': ContentParser.parse_www_form
    'application/json': ContentParser.parse_json



module.exports = ContentParser
